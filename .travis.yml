sudo: required
language: minimal
service: docker

before_install:
- openssl aes-256-cbc -K $encrypted_e14206e67f07_key -iv $encrypted_e14206e67f07_iv
  -in credentials.json.enc -out credentials.json -d

script:
  - |
      if [[ "$TRAVIS_BRANCH" = "master" ]]; then
        docker build -t deploy .
        docker run -t \
          -v `pwd`:/go/src/github.com/${TRAVIS_REPO_SLUG} \
          -e GOOGLE_PROJECT=${GOOGLE_PROJECT} \
          -e GOOGLE_CREDENTIALS=./credentials.json \
          -w /go/src/github.com/${TRAVIS_REPO_SLUG} \
          deploy tools/deploy
      fi
